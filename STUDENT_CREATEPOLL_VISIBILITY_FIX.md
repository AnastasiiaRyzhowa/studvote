# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥–∞ –ø–æ visibility

## üéØ –ü—Ä–æ–±–ª–µ–º–∞

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ–ø—Ä–æ—Å–∞ —Å—Ç—É–¥–µ–Ω—Ç–æ–º/–ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª–µ–º `target_faculties` –≤—Å–µ–≥–¥–∞ –æ—Å—Ç–∞–≤–∞–ª—Å—è **–ø—É—Å—Ç—ã–º**, –¥–∞–∂–µ –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω `visibility: 'faculty'`. –ó–∞–ø–æ–ª–Ω—è–ª—Å—è —Ç–æ–ª—å–∫–æ `target_groups`.

```javascript
// ‚ùå –ë–´–õ–û (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
target_groups: user?.group_id ? [user.group_id] : [],  // –í—Å–µ–≥–¥–∞ –∑–∞–ø–æ–ª–Ω—è–ª—Å—è
target_faculties: [],                                  // –í—Å–µ–≥–¥–∞ –ø—É—Å—Ç–æ–π!
target_programs: [],
target_courses: []
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –í—ã–±—Ä–∞–ª visibility='faculty' ‚Üí –æ–ø—Ä–æ—Å –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–ª—Å—è —Å—Ç—É–¥–µ–Ω—Ç–∞–º —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞
- Backend –Ω–µ –∑–Ω–∞–ª, –∫–∞–∫–æ–º—É —Ñ–∞–∫—É–ª—å—Ç–µ—Ç—É –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –æ–ø—Ä–æ—Å
- `target_faculties: []` ‚Üí –ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
–¢–∞—Ä–≥–µ—Ç–∏–Ω–≥ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è **–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ `visibility`**:

```javascript
// ‚úÖ –°–¢–ê–õ–û (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
target_groups: formData.visibility === 'group' 
  ? (user?.group_id ? [user.group_id] : [])
  : [],
target_faculties: formData.visibility === 'faculty'
  ? (user?.faculty ? [user.faculty] : [])
  : [],
target_programs: [],
target_courses: []
```

---

## üîÑ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã

### 1Ô∏è‚É£ –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω `visibility: 'group'`

```javascript
visibility: 'group'
‚Üì
target_groups: [user.group_id]    // ‚Üê –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è
target_faculties: []               // ‚Üê –ü—É—Å—Ç–æ–π
```

**–ü—Ä–∏–º–µ—Ä:**
```json
{
  "visibility": "group",
  "target_groups": ["12345"],      // ‚Üê ID –≥—Ä—É–ø–ø—ã —Å—Ç—É–¥–µ–Ω—Ç–∞
  "target_faculties": [],
  "target_programs": [],
  "target_courses": []
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û–ø—Ä–æ—Å –≤–∏–¥–µ–Ω —Ç–æ–ª—å–∫–æ —Å—Ç—É–¥–µ–Ω—Ç–∞–º –≥—Ä—É–ø–ø—ã 22–ú–û05

---

### 2Ô∏è‚É£ –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω `visibility: 'faculty'`

```javascript
visibility: 'faculty'
‚Üì
target_groups: []                  // ‚Üê –ü—É—Å—Ç–æ–π
target_faculties: [user.faculty]   // ‚Üê –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è!
```

**–ü—Ä–∏–º–µ—Ä:**
```json
{
  "visibility": "faculty",
  "target_groups": [],
  "target_faculties": ["–§–ò–¢–∏–ê–ë–î"],  // ‚Üê –ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞ —Å—Ç—É–¥–µ–Ω—Ç–∞
  "target_programs": [],
  "target_courses": []
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û–ø—Ä–æ—Å –≤–∏–¥–µ–Ω –≤—Å–µ–º —Å—Ç—É–¥–µ–Ω—Ç–∞–º —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞ –§–ò–¢–∏–ê–ë–î

---

### 3Ô∏è‚É£ –ï—Å–ª–∏ –≤—ã–±—Ä–∞–Ω `visibility: 'public'`

```javascript
visibility: 'public'
‚Üì
target_groups: []                  // ‚Üê –ü—É—Å—Ç–æ–π
target_faculties: []               // ‚Üê –ü—É—Å—Ç–æ–π
```

**–ü—Ä–∏–º–µ—Ä:**
```json
{
  "visibility": "public",
  "target_groups": [],
  "target_faculties": [],
  "target_programs": [],
  "target_courses": []
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û–ø—Ä–æ—Å –≤–∏–¥–µ–Ω –≤—Å–µ–º —Å—Ç—É–¥–µ–Ω—Ç–∞–º

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –î–æ –∏ –ü–æ—Å–ª–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π: –°—Ç—É–¥–µ–Ω—Ç –§–ò–¢–∏–ê–ë–î —Å–æ–∑–¥–∞–µ—Ç –æ–ø—Ä–æ—Å –¥–ª—è —Å–≤–æ–µ–≥–æ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞

**–î–û –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```json
{
  "visibility": "faculty",
  "target_groups": ["12345"],      // ‚Üê –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ! –ì—Ä—É–ø–ø–∞ –≤–º–µ—Å—Ç–æ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞
  "target_faculties": [],          // ‚Üê –ü—É—Å—Ç–æ–π!
  "target_programs": [],
  "target_courses": []
}
```
**–ü—Ä–æ–±–ª–µ–º–∞:** Backend –Ω–µ –∑–Ω–∞–µ—Ç, –∫–∞–∫–æ–º—É —Ñ–∞–∫—É–ª—å—Ç–µ—Ç—É –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å ‚Üí –æ–ø—Ä–æ—Å –Ω–µ –≤–∏–¥–µ–Ω –Ω–∏–∫–æ–º—É –∏–∑ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞

---

**–ü–û–°–õ–ï –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```json
{
  "visibility": "faculty",
  "target_groups": [],             // ‚Üê –ü—É—Å—Ç–æ–π (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
  "target_faculties": ["–§–ò–¢–∏–ê–ë–î"], // ‚Üê –ó–∞–ø–æ–ª–Ω–µ–Ω!
  "target_programs": [],
  "target_courses": []
}
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Backend –∑–Ω–∞–µ—Ç, —á—Ç–æ –æ–ø—Ä–æ—Å –¥–ª—è –§–ò–¢–∏–ê–ë–î ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ–º —Å—Ç—É–¥–µ–Ω—Ç–∞–º —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞ ‚úÖ

---

## üõ†Ô∏è –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### –§–∞–π–ª: `/client/src/pages/CreatePoll.js`

**–°—Ç—Ä–æ–∫–∏ 473-481:**

```javascript
// –ë–´–õ–û:
target_groups: formData.target_groups && formData.target_groups.length
  ? formData.target_groups
  : (user?.group_id ? [user.group_id] : []),
target_faculties: [],
target_programs: [],
target_courses: []
```

```javascript
// –°–¢–ê–õ–û:
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç visibility
target_groups: formData.visibility === 'group' 
  ? (user?.group_id ? [user.group_id] : [])
  : [],
target_faculties: formData.visibility === 'faculty'
  ? (user?.faculty ? [user.faculty] : [])
  : [],
target_programs: [],
target_courses: []
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –°–æ–∑–¥–∞–Ω–∏–µ –æ–ø—Ä–æ—Å–∞ –¥–ª—è —Å–≤–æ–µ–π –≥—Ä—É–ø–ø—ã

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –í–æ–π—Ç–∏ –∫–∞–∫ —Å—Ç—É–¥–µ–Ω—Ç –≥—Ä—É–ø–ø—ã 22–ú–û05
2. –°–æ–∑–¥–∞—Ç—å –æ–ø—Ä–æ—Å
3. –í—ã–±—Ä–∞—Ç—å visibility: **"–¢–æ–ª—å–∫–æ –º–æ—è –≥—Ä—É–ø–ø–∞"**
4. –°–æ–∑–¥–∞—Ç—å –æ–ø—Ä–æ—Å

**–û–∂–∏–¥–∞–µ–º—ã–π payload:**
```json
{
  "visibility": "group",
  "target_groups": ["12345"],    // ‚Üê ID –≥—Ä—É–ø–ø—ã
  "target_faculties": []
}
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```javascript
console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ–ø—Ä–æ—Å–∞:', pollData);
// target_groups: ["12345"] ‚úÖ
// target_faculties: [] ‚úÖ
```

---

### –¢–µ—Å—Ç 2: –°–æ–∑–¥–∞–Ω–∏–µ –æ–ø—Ä–æ—Å–∞ –¥–ª—è —Å–≤–æ–µ–≥–æ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –í–æ–π—Ç–∏ –∫–∞–∫ —Å—Ç—É–¥–µ–Ω—Ç –§–ò–¢–∏–ê–ë–î
2. –°–æ–∑–¥–∞—Ç—å –æ–ø—Ä–æ—Å
3. –í—ã–±—Ä–∞—Ç—å visibility: **"–ú–æ–π —Ñ–∞–∫—É–ª—å—Ç–µ—Ç"**
4. –°–æ–∑–¥–∞—Ç—å –æ–ø—Ä–æ—Å

**–û–∂–∏–¥–∞–µ–º—ã–π payload:**
```json
{
  "visibility": "faculty",
  "target_groups": [],
  "target_faculties": ["–§–ò–¢–∏–ê–ë–î"]  // ‚Üê –ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞
}
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```javascript
console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ–ø—Ä–æ—Å–∞:', pollData);
// target_groups: [] ‚úÖ
// target_faculties: ["–§–ò–¢–∏–ê–ë–î"] ‚úÖ
```

---

### –¢–µ—Å—Ç 3: –°–æ–∑–¥–∞–Ω–∏–µ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –æ–ø—Ä–æ—Å–∞

**–î–µ–π—Å—Ç–≤–∏—è:**
1. –í–æ–π—Ç–∏ –∫–∞–∫ —Å—Ç—É–¥–µ–Ω—Ç
2. –°–æ–∑–¥–∞—Ç—å –æ–ø—Ä–æ—Å
3. –í—ã–±—Ä–∞—Ç—å visibility: **"–í—Å–µ —Å—Ç—É–¥–µ–Ω—Ç—ã"**
4. –°–æ–∑–¥–∞—Ç—å –æ–ø—Ä–æ—Å

**–û–∂–∏–¥–∞–µ–º—ã–π payload:**
```json
{
  "visibility": "public",
  "target_groups": [],
  "target_faculties": []
}
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```javascript
console.log('–û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ–ø—Ä–æ—Å–∞:', pollData);
// target_groups: [] ‚úÖ
// target_faculties: [] ‚úÖ
```

---

## üîç –û—Ç–∫—É–¥–∞ –±–µ—Ä–µ—Ç—Å—è `user.faculty`

### –ò–∑ AuthContext:

```javascript
const { user } = useAuth();

// user –æ–±—ä–µ–∫—Ç:
{
  id: "user_123",
  email: "student@edu.hse.ru",
  role: "student",
  group_id: "12345",       // ‚Üê –î–ª—è target_groups
  group: "22–ú–û05",
  faculty: "–§–ò–¢–∏–ê–ë–î",      // ‚Üê –î–ª—è target_faculties!
  program: "DevOps",
  course: 2
}
```

### `user.faculty` —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è:

1. **–ü—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏** (Register.js):
   - –°—Ç—É–¥–µ–Ω—Ç –≤—ã–±–∏—Ä–∞–µ—Ç —Ñ–∞–∫—É–ª—å—Ç–µ—Ç —á–µ—Ä–µ–∑ –∫–∞—Å–∫–∞–¥–Ω—ã–π —Å–µ–ª–µ–∫—Ç
   - Backend —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ User.faculty

2. **–ü—Ä–∏ –ª–æ–≥–∏–Ω–µ**:
   - Backend –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç user —Å –ø–æ–ª–µ–º `faculty`
   - AuthContext —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ state

---

## üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ Backend

### Backend –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–≤–µ—Ä—è—Ç—å:

```javascript
// Poll.js - –º–µ—Ç–æ–¥ isVisibleTo(user)
if (this.target_faculties.length > 0 && this.target_faculties.includes(user.faculty)) {
  return true;
}
```

**–£–±–µ–¥–∏—Å—å, —á—Ç–æ:**
- ‚úÖ User –º–æ–¥–µ–ª—å –∏–º–µ–µ—Ç –ø–æ–ª–µ `faculty`
- ‚úÖ Poll.isVisibleTo() –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `target_faculties`
- ‚úÖ Backend –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –æ–ø—Ä–æ—Å—ã –ø–æ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç—É

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è

### 1. –§–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö:

```javascript
// user.faculty - —ç—Ç–æ –°–¢–†–û–ö–ê (–Ω–µ ID):
user.faculty = "–§–ò–¢–∏–ê–ë–î"  // ‚Üê –ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞

// –ù–ï:
user.faculty_id = "1"     // ‚Üê –ù–µ—Ç —Ç–∞–∫–æ–≥–æ –ø–æ–ª—è!
```

### 2. Backend –¥–æ–ª–∂–µ–Ω —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å —Å—Ç—Ä–æ–∫–∏:

```javascript
// –ü—Ä–∞–≤–∏–ª—å–Ω–æ:
target_faculties.includes(user.faculty)  // ["–§–ò–¢–∏–ê–ë–î"].includes("–§–ò–¢–∏–ê–ë–î")

// –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ:
target_faculties.includes(user.faculty_id)
```

### 3. –†–µ–≥–∏—Å—Ç—Ä –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ:

```javascript
user.faculty = "–§–ò–¢–∏–ê–ë–î"
target_faculties = ["—Ñ–∏—Ç–∏–∞–±–¥"]  // ‚Üê –ù–ï —Å–æ–≤–ø–∞–¥–µ—Ç!

// –£–±–µ–¥–∏—Å—å, —á—Ç–æ —Ä–µ–≥–∏—Å—Ç—Ä —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –æ–¥–∏–Ω–∞–∫–æ–≤–æ
```

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
–°—Ç—É–¥–µ–Ω—Ç –§–ò–¢–∏–ê–ë–î –≤—ã–±–∏—Ä–∞–µ—Ç visibility='faculty'
  ‚Üì
  target_faculties: [] (–ø—É—Å—Ç–æ–π)
  ‚Üì
  Backend –Ω–µ –∑–Ω–∞–µ—Ç, –∫–∞–∫–æ–º—É —Ñ–∞–∫—É–ª—å—Ç–µ—Ç—É –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å
  ‚Üì
  –û–ø—Ä–æ—Å –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å—Ç—É–¥–µ–Ω—Ç–∞–º —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞ ‚ùå
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
–°—Ç—É–¥–µ–Ω—Ç –§–ò–¢–∏–ê–ë–î –≤—ã–±–∏—Ä–∞–µ—Ç visibility='faculty'
  ‚Üì
  target_faculties: ["–§–ò–¢–∏–ê–ë–î"]
  ‚Üì
  Backend –ø—Ä–æ–≤–µ—Ä—è–µ—Ç user.faculty === "–§–ò–¢–∏–ê–ë–î"
  ‚Üì
  –û–ø—Ä–æ—Å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤—Å–µ–º —Å—Ç—É–¥–µ–Ω—Ç–∞–º –§–ò–¢–∏–ê–ë–î ‚úÖ
```

---

## üéØ –ò—Ç–æ–≥–æ–≤–∞—è –ª–æ–≥–∏–∫–∞

```javascript
if (visibility === 'group') {
  target_groups = [user.group_id]    // –ì—Ä—É–ø–ø–∞ —Å—Ç—É–¥–µ–Ω—Ç–∞
  target_faculties = []
}

if (visibility === 'faculty') {
  target_groups = []
  target_faculties = [user.faculty]  // –§–∞–∫—É–ª—å—Ç–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç–∞
}

if (visibility === 'public') {
  target_groups = []
  target_faculties = []              // –í—Å–µ —Å—Ç—É–¥–µ–Ω—Ç—ã
}
```

---

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ! –¢–µ–ø–µ—Ä—å —Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–ª—è –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –≤–∏–¥–∏–º–æ—Å—Ç–∏. ‚úÖ

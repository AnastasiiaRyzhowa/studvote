# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: MissingSchemaError –¥–ª—è –º–æ–¥–µ–ª–∏ Badge

## üî¥ **–û—à–∏–±–∫–∞:**

```
MissingSchemaError: Schema hasn't been registered for model "Badge".
Use mongoose.model(name, schema)
    at exports.getMe (/server/src/controllers/authController.js)
```

**–°–∏–º–ø—Ç–æ–º:** –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (F5) –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞.

---

## üîç **–ü—Ä–∏—á–∏–Ω–∞:**

–í `/server/src/controllers/authController.js` –º–µ—Ç–æ–¥ `getMe()` –ø—ã—Ç–∞–µ—Ç—Å—è —Å–¥–µ–ª–∞—Ç—å `.populate()` –¥–ª—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –º–æ–¥–µ–ª–∏ `Badge`:

```javascript
// ‚ùå –ë–´–õ–û (—Å—Ç—Ä–æ–∫–∏ 401-403):
const user = await User.findById(req.user.userId)
  .populate('student_data.badges', 'name icon description')  // ‚Üê Badge –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!
  .populate('badges', 'name icon description');              // ‚Üê Badge –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**
1. Frontend –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)
2. AuthContext –≤—ã–∑—ã–≤–∞–µ—Ç `GET /api/auth/me`
3. Backend –ø—ã—Ç–∞–µ—Ç—Å—è —Å–¥–µ–ª–∞—Ç—å `.populate('badges')`
4. Mongoose –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç –º–æ–¥–µ–ª—å `Badge` ‚Üí **MissingSchemaError** ‚ùå
5. –ó–∞–ø—Ä–æ—Å –ø–∞–¥–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π 500
6. Frontend –ø–æ–ª—É—á–∞–µ—Ç –æ—à–∏–±–∫—É ‚Üí —É–¥–∞–ª—è–µ—Ç —Ç–æ–∫–µ–Ω ‚Üí —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/login`

---

## ‚úÖ **–†–µ—à–µ–Ω–∏–µ:**

–£–±—Ä–∞–ª–∏ `.populate()` –¥–ª—è badges:

```javascript
// ‚úÖ –°–¢–ê–õ–û (—Å—Ç—Ä–æ–∫–∏ 401-402):
// –£–±—Ä–∞–ª–∏ .populate –¥–ª—è badges, —Ç–∞–∫ –∫–∞–∫ –º–æ–¥–µ–ª—å Badge –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
const user = await User.findById(req.user.userId);
```

**–¢–µ–ø–µ—Ä—å:**
- ‚úÖ –ó–∞–ø—Ä–æ—Å `/api/auth/me` —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å—Ç–∞–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–∫–∏ MissingSchemaError

---

## üîß **–ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ –≤ —Ñ–∞–π–ª–µ

**–§–∞–π–ª:** `/server/src/controllers/authController.js` (—Å—Ç—Ä–æ–∫–∏ 401-402)

### 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend —Å–µ—Ä–≤–µ—Ä

**–û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–µ–∫—É—â–∏–π –ø—Ä–æ—Ü–µ—Å—Å:** Ctrl+C –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ –≥–¥–µ –∑–∞–ø—É—â–µ–Ω backend

**–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–Ω–æ–≤–æ:**
```bash
cd server
npm start
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:**
```
üöÄ –°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç–µ 4000
‚úÖ MongoDB –ø–æ–¥–∫–ª—é—á–µ–Ω–∞
‚úÖ Redis –ø–æ–¥–∫–ª—é—á–µ–Ω
```

---

## üß™ **–ü—Ä–æ–≤–µ—Ä–∫–∞:**

### –®–∞–≥ 1: –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000/login
2. –í–≤–µ–¥–∏—Ç–µ email –∏ –ø–æ–ª—É—á–∏—Ç–µ –∫–æ–¥
3. –í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É

### –®–∞–≥ 2: –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É

1. –ù–∞—Ö–æ–¥—è—Å—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å—Ç—É–¥–µ–Ω—Ç–∞, –Ω–∞–∂–º–∏—Ç–µ **F5**
2. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12 ‚Üí Console)

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
üîë –¢–æ–∫–µ–Ω –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é...
‚úÖ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞: 216890@edu.fa.ru
```

‚úÖ **–í—ã –æ—Å—Ç–∞–µ—Ç–µ—Å—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å—Ç—É–¥–µ–Ω—Ç–∞!**

---

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network tab

–û—Ç–∫—Ä–æ–π—Ç–µ **DevTools ‚Üí Network ‚Üí XHR**

1. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)
2. –ù–∞–π–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å `GET /api/auth/me`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- –°—Ç–∞—Ç—É—Å: **200 OK** ‚úÖ
- Response:
  ```json
  {
    "success": true,
    "user": {
      "id": "...",
      "email": "216890@edu.fa.ru",
      "role": "student",
      ...
    }
  }
  ```

---

## üìä **–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:**

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

```
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (F5)
  ‚Üì
GET /api/auth/me
  ‚Üì
User.findById().populate('badges') ‚Üê Badge –º–æ–¥–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
  ‚Üì
MissingSchemaError ‚ùå
  ‚Üì
500 Server Error
  ‚Üì
Frontend: removeToken() ‚Üí –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /login ‚ùå
```

---

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

```
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (F5)
  ‚Üì
GET /api/auth/me
  ‚Üì
User.findById() ‚Üê –ë–µ–∑ .populate('badges')
  ‚Üì
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω ‚úÖ
  ‚Üì
200 OK + userData
  ‚Üì
Frontend: setState({ isAuthenticated: true }) ‚úÖ
  ‚Üì
–û—Å—Ç–∞—ë—Ç–µ—Å—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å—Ç—É–¥–µ–Ω—Ç–∞ ‚úÖ
```

---

## üîç **–ü–æ—á–µ–º—É –º–æ–¥–µ–ª—å Badge –Ω–µ –Ω—É–∂–Ω–∞ (–ø–æ–∫–∞):**

–ú–æ–¥–µ–ª—å `Badge` (–∑–Ω–∞—á–∫–∏/–¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è) –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –í –º–æ–¥–µ–ª–∏ `User` –µ—Å—Ç—å –ø–æ–ª—è:

```javascript
// User.js
student_data: {
  badges: [{ type: mongoose.Schema.Types.ObjectId, ref: 'Badge' }]
},
badges: [{ type: mongoose.Schema.Types.ObjectId, ref: 'Badge' }]
```

–ù–æ —Å–∞–º–∞ –º–æ–¥–µ–ª—å `Badge` –Ω–µ —Å–æ–∑–¥–∞–Ω–∞. –ü–æ—ç—Ç–æ–º—É:
- ‚úÖ –ü–æ–ª—è `badges` –æ—Å—Ç–∞—é—Ç—Å—è –ø—É—Å—Ç—ã–º–∏ –º–∞—Å—Å–∏–≤–∞–º–∏ `[]`
- ‚úÖ `.populate()` –Ω–µ –Ω—É–∂–µ–Ω, —Ç–∞–∫ –∫–∞–∫ –Ω–µ—á–µ–≥–æ –∑–∞–ø–æ–ª–Ω—è—Ç—å
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ badges

---

## üìù **–ï—Å–ª–∏ –≤ –±—É–¥—É—â–µ–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –º–æ–¥–µ–ª—å Badge:**

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `/server/src/models/Badge.js`:

```javascript
const mongoose = require('mongoose');

const badgeSchema = new mongoose.Schema({
  name: {
    type: String,
    required: true
  },
  icon: {
    type: String,
    required: true
  },
  description: {
    type: String
  },
  points_required: {
    type: Number,
    default: 0
  }
}, {
  timestamps: true
});

module.exports = mongoose.model('Badge', badgeSchema);
```

–ò –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –≤ `server.js`:

```javascript
const Badge = require('./models/Badge');
```

**–¢–æ–≥–¥–∞** –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –≤–µ—Ä–Ω—É—Ç—å `.populate('badges')` –≤ `getMe()`.

---

## ‚úÖ **–ò—Ç–æ–≥:**

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
‚ùå MissingSchemaError –ø—Ä–∏ GET /api/auth/me
‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ /login –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
‚úÖ GET /api/auth/me —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –æ—à–∏–±–æ–∫
‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Å—Ç–∞–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –ø–æ—Å–ª–µ F5
‚úÖ –ù–µ—Ç –æ—à–∏–±–∫–∏ MissingSchemaError
```

---

## üöÄ **–î–µ–π—Å—Ç–≤–∏—è:**

1. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ –≤ `authController.js`
2. ‚è≥ **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend —Å–µ—Ä–≤–µ—Ä**
3. ‚úÖ –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5) - –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å!

```bash
cd server
npm start
```

---

–ì–æ—Ç–æ–≤–æ! –ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞. üéâ

# Руководство по созданию анкет (Form Creation)

## Обзор

Система поддержки мультивопросных форм расширяет функциональность опросов, позволяя создавать комплексные анкеты с различными типами вопросов.

## Обновленные файлы

### Backend

#### `/server/src/models/Poll.js`

Модель Poll была обновлена для поддержки форм:

**Новые поля:**

1. **type** - добавлен тип `'form'`
   ```javascript
   type: {
     type: String,
     enum: ['single', 'multiple', 'rating', 'form'],
     required: true,
     default: 'single'
   }
   ```

2. **questions** - массив вопросов для форм
   ```javascript
   questions: [{
     id: String,              // Уникальный ID вопроса
     text: String,            // Текст вопроса
     type: String,            // Тип: single/multiple/rating/text
     required: Boolean,       // Обязательный или нет
     options: [String],       // Варианты ответов
     max_choices: Number      // Макс. количество выборов
   }]
   ```

3. **responses** - ответы на формы
   ```javascript
   responses: [{
     user_id: ObjectId,       // ID пользователя
     answers: Map,            // Карта: question_id → ответ
     created_at: Date         // Время ответа
   }]
   ```

**Особенности:**
- `options` требуется только для обычных опросов (не для форм)
- `questions` используется только когда `type === 'form'`
- `responses` используется для форм вместо `votes`
- Полная обратная совместимость с существующими опросами

### Frontend

#### `/client/src/pages/CreateForm.js`

Новая страница для создания мультивопросных анкет.

**Основные возможности:**

1. **Заголовок и описание**
   - Название анкеты (5-200 символов)
   - Описание (необязательное, до 2000 символов)

2. **Управление вопросами**
   - Добавление/удаление вопросов
   - Минимум 1 вопрос
   - Drag-and-drop индикатор для будущей сортировки

3. **Типы вопросов**
   - **Single** - один вариант ответа
   - **Multiple** - несколько вариантов ответа
   - **Rating** - рейтинг от 1 до 5 звезд
   - **Text** - свободный текстовый ответ

4. **Настройки вопросов**
   - Текст вопроса
   - Тип вопроса
   - Обязательность
   - Варианты ответов (для single/multiple)
   - Минимум 2 варианта для вопросов с выбором

5. **Общие настройки**
   - Дата и время окончания
   - Видимость (public/group/faculty)
   - Анонимность

6. **Валидация**
   - Проверка заполнения обязательных полей
   - Проверка минимального количества вариантов
   - Проверка даты окончания (должна быть в будущем)
   - Проверка длины названия

#### `/client/src/App.js`

Добавлен новый роут:
```javascript
<Route path="/forms/create" element={<ProtectedRoute><CreateForm /></ProtectedRoute>} />
```

## Использование

### Создание анкеты

1. Перейдите по адресу `/forms/create`
2. Заполните название и описание
3. Добавьте вопросы через кнопку "Добавить вопрос"
4. Для каждого вопроса:
   - Введите текст
   - Выберите тип
   - Отметьте обязательность (при необходимости)
   - Добавьте варианты ответов (для single/multiple)
5. Настройте дедлайн и видимость
6. Нажмите "Создать анкету"

### Структура данных при создании

```javascript
{
  title: "Название анкеты",
  description: "Описание",
  type: "form",
  questions: [
    {
      id: "q1",
      text: "Ваш любимый предмет?",
      type: "single",
      required: true,
      options: ["Математика", "Физика", "Информатика"],
      max_choices: 1
    },
    {
      id: "q2",
      text: "Что вам нравится в университете?",
      type: "multiple",
      required: false,
      options: ["Преподаватели", "Библиотека", "Кампус"],
      max_choices: 3
    },
    {
      id: "q3",
      text: "Оцените качество образования",
      type: "rating",
      required: true,
      options: [],
      max_choices: 1
    },
    {
      id: "q4",
      text: "Ваши предложения",
      type: "text",
      required: false,
      options: [],
      max_choices: 1
    }
  ],
  end_date: "2024-12-31T23:59",
  visibility: "public",
  is_anonymous: false
}
```

## Компоненты интерфейса

### Карточка вопроса
- Иконка перетаскивания (для будущего функционала)
- Номер вопроса
- Кнопка удаления
- Поле для текста вопроса
- Выбор типа вопроса
- Чекбокс обязательности
- Варианты ответов (для single/multiple)
- Информационные подсказки (для rating/text)

### UI/UX особенности
- Material-UI компоненты
- Адаптивный дизайн (Grid система)
- Валидация в реальном времени
- Информативные сообщения об ошибках
- Disabled состояния для недопустимых действий
- Подсказки (tooltips) на кнопках
- Счетчики символов для текстовых полей

## Следующие шаги

### Backend
- [ ] Обновить контроллер `pollController.js` для обработки форм
- [ ] Добавить валидацию данных форм
- [ ] Создать endpoint для отправки ответов на формы
- [ ] Создать endpoint для получения ответов

### Frontend
- [ ] Создать страницу отображения формы для заполнения
- [ ] Создать страницу результатов формы
- [ ] Добавить функционал drag-and-drop для сортировки вопросов
- [ ] Добавить предпросмотр анкеты перед публикацией
- [ ] Добавить шаблоны анкет

## Примечания

- Формы полностью совместимы с существующей системой опросов
- Используется та же модель `Poll`, что обеспечивает единообразие
- Разделение логики: `votes` для опросов, `responses` для форм
- Все существующие опросы продолжают работать без изменений

## API Integration

Текущая интеграция использует существующую функцию `createPoll` из `pollService.js`. При необходимости можно создать отдельную функцию `createForm` для более специфической обработки.

```javascript
// Пример использования
import { createPoll } from '../services/pollService';

const formData = {
  type: 'form',
  title: '...',
  questions: [...]
};

await createPoll(formData);
```
























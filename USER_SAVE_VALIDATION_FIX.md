# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üêõ –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –≤—Ö–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤–æ–∑–Ω–∏–∫–∞–ª–∞ –æ—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ Mongoose:

```
ValidationError: User validation failed: program: Path `program` is required.
    at exports.verifyCode (/server/src/controllers/authController.js:174:7)
```

**–ü—Ä–∏—á–∏–Ω–∞:**
–í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –µ—Å—Ç—å —Å—Ç—É–¥–µ–Ω—Ç—ã (–≤–µ—Ä–æ—è—Ç–Ω–æ, —Å—Ç–∞—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏), —É –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –ø–æ–ª–µ `program`. –ü—Ä–∏ –≤—Ö–æ–¥–µ —Å–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç `last_login` –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `user.save()`, –Ω–æ Mongoose –∑–∞–ø—É—Å–∫–∞–µ—Ç –ø–æ–ª–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤—Å–µ—Ö –ø–æ–ª–µ–π –º–æ–¥–µ–ª–∏, –≤–∫–ª—é—á–∞—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ `program`, –∫–æ—Ç–æ—Ä–æ–µ —É —Å—Ç–∞—Ä—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π `undefined`.

---

## üìä –ú–æ–¥–µ–ª—å User - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è

–í `/server/src/models/User.js`:

```javascript
program: { 
  type: String, 
  required: function() { return this.role === 'student'; }  // ‚Üê –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤!
},
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –°—Ç–∞—Ä—ã–π —Å—Ç—É–¥–µ–Ω—Ç –±–µ–∑ `program` –ø—ã—Ç–∞–µ—Ç—Å—è –≤–æ–π—Ç–∏
- –°–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç `user.last_login = new Date()`
- –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `user.save()`
- Mongoose –ø—Ä–æ–≤–µ—Ä—è–µ—Ç **–í–°–ï** –ø–æ–ª—è, –≤–∫–ª—é—á–∞—è `program`
- –û—à–∏–±–∫–∞: `program` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω, –Ω–æ –æ–Ω `undefined`

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–ø—Ü–∏—é `{ validateModifiedOnly: true }` –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –≠—Ç–æ –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç Mongoose –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ç–æ–ª—å–∫–æ **–∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ** –ø–æ–ª—è, –∞ –Ω–µ –≤–µ—Å—å –¥–æ–∫—É–º–µ–Ω—Ç.

### –ü—Ä–∏–º–µ—Ä:

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```javascript
user.last_login = new Date();
await user.save();  // ‚ùå –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –í–°–ï –ø–æ–ª—è, –≤–∫–ª—é—á–∞—è program
```

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```javascript
user.last_login = new Date();
await user.save({ validateModifiedOnly: true });  // ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ last_login
```

---

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### 1. `/server/src/controllers/authController.js`

#### verifyCode() - –í—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å—Ç—Ä–æ–∫–∞ 174)
```javascript
// –û–±–Ω–æ–≤–ª—è–µ–º last_login
user.last_login = new Date();
// –ò—Å–ø–æ–ª—å–∑—É–µ–º validateModifiedOnly –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π
await user.save({ validateModifiedOnly: true });
```

#### getMe() - –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è (—Å—Ç—Ä–æ–∫–∞ 427)
```javascript
// –û–±–Ω–æ–≤–ª—è–µ–º last_login
user.last_login = new Date();
// –ò—Å–ø–æ–ª—å–∑—É–µ–º validateModifiedOnly –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π
await user.save({ validateModifiedOnly: true });
```

---

### 2. `/server/src/controllers/pollController.js`

#### –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ - —É–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–∞ (—Å—Ç—Ä–æ–∫–∞ 1721)
```javascript
// –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á—ë—Ç—á–∏–∫ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–π
if (typeof user.incrementVotes === 'function') {
  await user.incrementVotes();
} else {
  user.votes_count = (user.votes_count || 0) + 1;
  await user.save({ validateModifiedOnly: true });  // ‚úÖ
}
```

#### –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ - –Ω–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤ (—Å—Ç—Ä–æ–∫–∞ 1741)
```javascript
// –§–æ–ª–ª–±–µ–∫ –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –º–æ–¥–µ–ª–µ–π
user.points = (user.points || 0) + points;
if (user.student_data) {
  user.student_data.points = user.points;
}
await user.save({ validateModifiedOnly: true });  // ‚úÖ
```

---

### 3. `/server/src/routes/admin/usersRoutes.js`

#### PUT /users/:id - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å—Ç—Ä–æ–∫–∞ 234)
```javascript
// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π
const allowedFields = ['full_name', 'faculty', 'program', 'course', 'group'];

allowedFields.forEach(field => {
  if (req.body[field] !== undefined) {
    user[field] = req.body[field];
  }
});

// –ò—Å–ø–æ–ª—å–∑—É–µ–º validateModifiedOnly –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π
await user.save({ validateModifiedOnly: true });  // ‚úÖ
```

**–ó–∞—á–µ–º –∑–¥–µ—Å—å:**
–ï—Å–ª–∏ –∞–¥–º–∏–Ω –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ `full_name`, –Ω–æ —É —Å—Ç–∞—Ä–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç `program`, –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–µ —É–ø–∞–¥–µ—Ç.

---

#### PUT /users/:id/toggle-status - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (—Å—Ç—Ä–æ–∫–∞ 264)
```javascript
// undefined (—Å—Ç–∞—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏) —Å—á–∏—Ç–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–º–∏ -> –ø–µ—Ä–≤–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç
user.is_active = user.is_active === false ? true : false;
// –ò—Å–ø–æ–ª—å–∑—É–µ–º validateModifiedOnly –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π
await user.save({ validateModifiedOnly: true });  // ‚úÖ
```

---

#### PUT /users/:id/toggle-role - –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–æ–ª–∏ (—Å—Ç—Ä–æ–∫–∞ 301)
```javascript
user.role = user.role === 'admin' ? 'student' : 'admin';
// –ò—Å–ø–æ–ª—å–∑—É–µ–º validateModifiedOnly –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ–π
await user.save({ validateModifiedOnly: true });  // ‚úÖ
```

**–ó–∞—á–µ–º –∑–¥–µ—Å—å:**
–ü—Ä–∏ —Å–º–µ–Ω–µ —Ä–æ–ª–∏ —Å `student` –Ω–∞ `admin` (–∏–ª–∏ –æ–±—Ä–∞—Ç–Ω–æ) —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–æ–ª—è–º –º–µ–Ω—è—é—Ç—Å—è. `validateModifiedOnly` –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –±—ã–ª–∏ –∏–∑–º–µ–Ω–µ–Ω—ã.

---

## üõ°Ô∏è –ö–æ–≥–¥–∞ –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å validateModifiedOnly

### –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```javascript
// POST /admin/users - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const user = new User({
  email: req.body.email,
  full_name: req.body.full_name,
  role: req.body.role,
  faculty: role === 'student' ? faculty : undefined,
  program: role === 'student' ? program : undefined,  // ‚Üê –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω!
  course: role === 'student' ? parseInt(course) : undefined,
  group: role === 'student' ? group : undefined,
  is_active: true
});

await user.save();  // ‚úÖ –ë–ï–ó validateModifiedOnly - –Ω—É–∂–Ω–∞ –ø–æ–ª–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è!
```

**–ü–æ—á–µ–º—É:**
–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å **–≤—Å–µ** –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è, –∏–Ω–∞—á–µ –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

---

## üîç –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç validateModifiedOnly

### –ü—Ä–∏–º–µ—Ä 1: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ last_login

```javascript
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –±–∞–∑–µ:
{
  email: "old@student.ru",
  full_name: "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
  role: "student",
  faculty: "–§–ò–¢–∏–ê–ë–î",
  program: undefined,  // ‚Üê –ù–ï–¢ –ü–†–û–ì–†–ê–ú–ú–´!
  course: 2,
  group: "22–ú–û05",
  last_login: null
}

// –ö–æ–¥:
user.last_login = new Date();
await user.save({ validateModifiedOnly: true });

// Mongoose –ø—Ä–æ–≤–µ—Ä–∏—Ç –¢–û–õ–¨–ö–û:
// ‚úÖ last_login (–∏–∑–º–µ–Ω—ë–Ω) - –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–π–¥–µ—Ç
// ‚ùå program –ù–ï –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è (–Ω–µ –∏–∑–º–µ–Ω—ë–Ω)

// –†–µ–∑—É–ª—å—Ç–∞—Ç: ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ
```

---

### –ü—Ä–∏–º–µ—Ä 2: –ë–µ–∑ validateModifiedOnly (—Å—Ç–∞—Ä—ã–π –∫–æ–¥)

```javascript
// –¢–æ—Ç –∂–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:
{
  program: undefined,  // ‚Üê –ù–ï–¢ –ü–†–û–ì–†–ê–ú–ú–´!
}

// –ö–æ–¥:
user.last_login = new Date();
await user.save();  // ‚ùå –ë–ï–ó validateModifiedOnly

// Mongoose –ø—Ä–æ–≤–µ—Ä–∏—Ç –í–°–Å:
// ‚úÖ last_login - –û–ö
// ‚ùå program - required –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤! ‚Üí –û–®–ò–ë–ö–ê!

// –†–µ–∑—É–ª—å—Ç–∞—Ç: ‚ùå ValidationError: Path `program` is required
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: –í—Ö–æ–¥ —Å—Ç–∞—Ä–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞ –±–µ–∑ program

**–®–∞–≥–∏:**
1. –í –±–∞–∑–µ –µ—Å—Ç—å —Å—Ç—É–¥–µ–Ω—Ç –±–µ–∑ `program`:
   ```javascript
   {
     email: "216890@edu.fa.ru",
     role: "student",
     faculty: "–§–ò–¢–∏–ê–ë–î",
     program: undefined
   }
   ```
2. –°—Ç—É–¥–µ–Ω—Ç –ø—ã—Ç–∞–µ—Ç—Å—è –≤–æ–π—Ç–∏ —á–µ—Ä–µ–∑ `/auth/verify-code`
3. –°–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç `last_login`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –í—Ö–æ–¥ —É—Å–ø–µ—à–µ–Ω
- ‚úÖ `last_login` –æ–±–Ω–æ–≤–ª–µ–Ω
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

---

### –¢–µ—Å—Ç 2: –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ä–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞

**–®–∞–≥–∏:**
1. –°—Ç—É–¥–µ–Ω—Ç –±–µ–∑ `program` –≥–æ–ª–æ—Å—É–µ—Ç –≤ –æ–ø—Ä–æ—Å–µ
2. –°–∏—Å—Ç–µ–º–∞ –Ω–∞—á–∏—Å–ª—è–µ—Ç –±–∞–ª–ª—ã –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç `votes_count`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ì–æ–ª–æ—Å —É—á—Ç—ë–Ω
- ‚úÖ –ë–∞–ª–ª—ã –Ω–∞—á–∏—Å–ª–µ–Ω—ã
- ‚úÖ –°—á—ë—Ç—á–∏–∫ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–π –æ–±–Ω–æ–≤–ª–µ–Ω
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

---

### –¢–µ—Å—Ç 3: –ê–¥–º–∏–Ω –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å—Ç–∞—Ä–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞

**–®–∞–≥–∏:**
1. –ê–¥–º–∏–Ω –±–ª–æ–∫–∏—Ä—É–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç–∞ –±–µ–∑ `program` —á–µ—Ä–µ–∑ –∞–¥–º–∏–Ω–∫—É
2. –°–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç `is_active = false`

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

---

## üìù –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –û—Ç–∫–ª—é—á–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —Å–æ–≤—Å–µ–º (–ù–ï —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```javascript
await user.save({ validateBeforeSave: false });  // ‚ùå –ü–ª–æ—Ö–æ
```

**–ü–æ—á–µ–º—É –ø–ª–æ—Ö–æ:**
–û—Ç–∫–ª—é—á–∞–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø–æ–ª–Ω–æ—Å—Ç—å—é, –º–æ–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–¥–æ–ª–≥–æ)

–°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø–æ–ª–Ω–∏—Ç `program` –¥–ª—è –≤—Å–µ—Ö —Å—Ç–∞—Ä—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤:

```javascript
// migration-fill-program.js
const User = require('./models/User');

async function migrate() {
  const students = await User.find({ 
    role: 'student', 
    program: { $exists: false } 
  });

  for (const student of students) {
    student.program = 'Unknown Program';  // –î–µ—Ñ–æ–ª—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
    await student.save();
  }
}
```

**–ü–æ—á–µ–º—É –Ω–µ —Å–¥–µ–ª–∞–ª–∏:**
- –¢—Ä–µ–±—É–µ—Ç –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–µ—Ä–≤–∏—Å–∞
- –î–æ–ª–≥–æ –¥–ª—è –±–æ–ª—å—à–æ–π –±–∞–∑—ã
- –ù—É–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- `validateModifiedOnly` —Ä–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É –±—ã—Å—Ç—Ä–µ–µ

---

### –í–∞—Ä–∏–∞–Ω—Ç 3: –°–¥–µ–ª–∞—Ç—å program –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º (–ù–ï —Ä–µ—à–µ–Ω–∏–µ)

```javascript
program: { 
  type: String, 
  required: false  // ‚ùå –ü–æ—Ç–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–ª—è –Ω–æ–≤—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
},
```

**–ü–æ—á–µ–º—É –ø–ª–æ—Ö–æ:**
–ù–æ–≤—ã–µ —Å—Ç—É–¥–µ–Ω—Ç—ã —Å–º–æ–≥—É—Ç —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –±–µ–∑ –ø—Ä–æ–≥—Ä–∞–º–º—ã.

---

## ‚úÖ –ò—Ç–æ–≥

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
‚ùå –°—Ç–∞—Ä—ã–µ —Å—Ç—É–¥–µ–Ω—Ç—ã –±–µ–∑ program –Ω–µ –º–æ–≥—É—Ç –≤–æ–π—Ç–∏
‚ùå –û—à–∏–±–∫–∞: ValidationError: Path `program` is required
‚ùå –ê–¥–º–∏–Ω –Ω–µ –º–æ–∂–µ—Ç –æ–±–Ω–æ–≤–∏—Ç—å/–∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤
‚ùå –°—Ç–∞—Ä—ã–µ —Å—Ç—É–¥–µ–Ω—Ç—ã –Ω–µ –º–æ–≥—É—Ç –≥–æ–ª–æ—Å–æ–≤–∞—Ç—å
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
‚úÖ –°—Ç–∞—Ä—ã–µ —Å—Ç—É–¥–µ–Ω—Ç—ã –º–æ–≥—É—Ç –≤—Ö–æ–¥–∏—Ç—å
‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –ø–æ–ª—è
‚úÖ –ù–æ–≤—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø—Ä–æ—Ö–æ–¥—è—Ç –ø–æ–ª–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é
‚úÖ –ê–¥–º–∏–Ω –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å –≤—Å–µ–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
‚úÖ –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –≥–æ–ª–æ—Å–æ–≤–∞—Ç—å
```

---

## üìä –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

1. **authController.js** - 2 –º–µ—Å—Ç–∞
   - `verifyCode()` (—Å—Ç—Ä–æ–∫–∞ 174)
   - `getMe()` (—Å—Ç—Ä–æ–∫–∞ 427)

2. **pollController.js** - 2 –º–µ—Å—Ç–∞
   - –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–π (—Å—Ç—Ä–æ–∫–∞ 1721)
   - –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤ (—Å—Ç—Ä–æ–∫–∞ 1741)

3. **admin/usersRoutes.js** - 3 –º–µ—Å—Ç–∞
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å—Ç—Ä–æ–∫–∞ 234)
   - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ (—Å—Ç—Ä–æ–∫–∞ 264)
   - –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–æ–ª–∏ (—Å—Ç—Ä–æ–∫–∞ 301)

**–í—Å–µ–≥–æ:** 7 –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π ‚úÖ

---

## üîß –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤—Å–µ—Ö user.save()

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –Ω–∞–π—Ç–∏ –¥—Ä—É–≥–∏–µ –º–µ—Å—Ç–∞:

```bash
grep -rn "user\.save()" server/src --include="*.js"
```

---

–ü—Ä–æ–±–ª–µ–º–∞ —Ä–µ—à–µ–Ω–∞! –¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ —Å—Ç–∞—Ä—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, —É –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è. üéâ

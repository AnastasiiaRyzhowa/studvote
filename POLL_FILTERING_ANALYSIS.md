# –ê–Ω–∞–ª–∏–∑ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤

## üîç –ü—Ä–æ–±–ª–µ–º–∞

**–°–∏–º–ø—Ç–æ–º:** –ê–¥–º–∏–Ω —Å–æ–∑–¥–∞—ë—Ç –æ–ø—Ä–æ—Å –¥–ª—è –≥—Ä—É–ø–ø—ã "22–ú–û05", –Ω–æ –µ–≥–æ –≤–∏–¥—è—Ç **–í–°–ï —Å—Ç—É–¥–µ–Ω—Ç—ã**, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ —ç—Ç–∞ –≥—Ä—É–ø–ø–∞.

---

## üìä –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

### 1. Endpoint: `GET /api/polls`

**–§–∞–π–ª:** `/server/src/routes/pollRoutes.js` (—Å—Ç—Ä–æ–∫–∞ 12)
```javascript
router.get('/', authenticate, pollController.getPolls);
```

**–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä:** `/server/src/controllers/pollController.js` (—Å—Ç—Ä–æ–∫–∞ 484)

---

### 2. –ú–µ—Ç–æ–¥ `isVisibleTo()` –≤ –º–æ–¥–µ–ª–∏ Poll

**–§–∞–π–ª:** `/server/src/models/Poll.js` (—Å—Ç—Ä–æ–∫–∏ 406-436)

```javascript
// –ü—Ä–æ–≤–µ—Ä–∫–∞: –º–æ–∂–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–µ—Ç—å —ç—Ç–æ—Ç –æ–ø—Ä–æ—Å
PollSchema.methods.isVisibleTo = function(user) {
  // –ï—Å–ª–∏ —Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥ –Ω–µ –∑–∞–¥–∞–Ω - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ–º
  if (this.target_groups.length === 0 &&
      this.target_faculties.length === 0 &&
      this.target_programs.length === 0 &&
      this.target_courses.length === 0) {
    return true;
  }
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥—Ä—É–ø–ø—É
  if (this.target_groups.length > 0 && user.group_id && 
      this.target_groups.includes(user.group_id.toString())) {
    return true;
  }
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∞–∫—É–ª—å—Ç–µ—Ç
  if (this.target_faculties.length > 0 && 
      this.target_faculties.includes(user.faculty)) {
    return true;
  }
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ–≥—Ä–∞–º–º—É
  if (this.target_programs.length > 0 && 
      this.target_programs.includes(user.program)) {
    return true;
  }
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—É—Ä—Å
  if (this.target_courses.length > 0 && 
      this.target_courses.includes(user.course)) {
    return true;
  }
  
  return false;
};
```

**‚úÖ –ú–µ—Ç–æ–¥ isVisibleTo() —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ!**

---

## üêõ **–ü–†–û–ë–õ–ï–ú–ê: –ú–µ—Ç–æ–¥ `isVisibleTo()` –ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–¢–°–Ø –≤ `getPolls()`!**

### –¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞ –≤ `pollController.getPolls()` (—Å—Ç—Ä–æ–∫–∏ 520-542):

```javascript
// –î–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–ø—Ä–æ—Å–æ–≤ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–æ–ª–∏
if (req.user?.role === 'student' && !showAll) {
  const g = currentUser?.group;
  const gid = currentUser?.group_id;
  
  const visibilityOr = [
    { pollType: 'custom' },  // ‚ùå –í–°–ï –ö–ê–°–¢–û–ú–ù–´–ï –û–ü–†–û–°–´ –í–ò–î–ù–´ –í–°–ï–ú!
  ];
  
  // –û–ø—Ä–æ—Å—ã –¥–ª—è –≥—Ä—É–ø–ø—ã —Å—Ç—É–¥–µ–Ω—Ç–∞ (–ª—é–±–æ–≥–æ —Ç–∏–ø–∞)
  const groupConditions = [
    g ? { target_groups: g } : null,
    gid ? { target_groups: gid } : null,
    gid ? { target_groups: String(gid) } : null,
    g ? { 'lessonContext.group': g } : null,
    (g || gid) ? { 'lessonContext.groupId': (g || gid).toString() } : null
  ].filter(Boolean);
  
  if (groupConditions.length) {
    visibilityOr.push({ $or: groupConditions });
  }
  
  roleScope.push({ $or: visibilityOr });
}
```

### üî¥ **–ì–õ–ê–í–ù–´–ô –ë–ê–ì: –°—Ç—Ä–æ–∫–∞ 525**

```javascript
{ pollType: 'custom' },  // ‚ùå –í–°–ï –∫–∞—Å—Ç–æ–º–Ω—ã–µ –æ–ø—Ä–æ—Å—ã –≤–∏–¥–Ω—ã –í–°–ï–ú —Å—Ç—É–¥–µ–Ω—Ç–∞–º!
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

1. –ê–¥–º–∏–Ω —Å–æ–∑–¥–∞–µ—Ç –æ–ø—Ä–æ—Å:
   ```javascript
   {
     pollType: 'custom',
     title: '–û–ø—Ä–æ—Å –¥–ª—è 22–ú–û05',
     target_groups: ['12345'],  // ID –≥—Ä—É–ø–ø—ã 22–ú–û05
     target_faculties: [],
     target_programs: [],
     target_courses: []
   }
   ```

2. –°—Ç—É–¥–µ–Ω—Ç –≥—Ä—É–ø–ø—ã **23–ü–ò01** –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç `GET /api/polls?filter=active`

3. MongoDB –∑–∞–ø—Ä–æ—Å –≤–∫–ª—é—á–∞–µ—Ç —É—Å–ª–æ–≤–∏–µ:
   ```javascript
   {
     $or: [
       { pollType: 'custom' },  // ‚Üê –≠—Ç–æ —É—Å–ª–æ–≤–∏–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç!
       // ... –ø—Ä–æ–≤–µ—Ä–∫–∏ –≥—Ä—É–ø–ø—ã ...
     ]
   }
   ```

4. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û–ø—Ä–æ—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å—Ç—É–¥–µ–Ω—Ç—É 23–ü–ò01, —Ö–æ—Ç—è –æ–Ω —Å–æ–∑–¥–∞–Ω –¥–ª—è 22–ú–û05! ‚ùå

---

## üîß –†–µ—à–µ–Ω–∏–µ

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `isVisibleTo()` –ø–æ—Å–ª–µ –∑–∞–ø—Ä–æ—Å–∞ (post-filter)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ù–µ –º–µ–Ω—è–µ—Ç MongoDB –∑–∞–ø—Ä–æ—Å
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –º–µ—Ç–æ–¥
- –ü—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–∑ –ë–î)
- –ú–æ–∂–µ—Ç –ø–æ–≤–ª–∏—è—Ç—å –Ω–∞ –ø–∞–≥–∏–Ω–∞—Ü–∏—é

**–ö–æ–¥:**
```javascript
// –ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –æ–ø—Ä–æ—Å–æ–≤ –∏–∑ –ë–î
const polls = await Poll.find(query)
  .populate('creator_id', 'full_name email role')
  .sort({ created_at: -1 })
  .skip(skip)
  .limit(limitNum)
  .lean();

// ‚úÖ –§–ò–õ–¨–¢–†–£–ï–ú —á–µ—Ä–µ–∑ isVisibleTo()
const visiblePolls = polls.filter(poll => {
  // –°–æ–∑–¥–∞–µ–º Mongoose –¥–æ–∫—É–º–µ–Ω—Ç –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–µ—Ç–æ–¥–∞
  const pollDoc = new Poll(poll);
  return pollDoc.isVisibleTo(currentUser);
});

// –î–∞–ª—å–Ω–µ–π—à–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞...
```

---

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø—Ä–∞–≤–∏—Ç—å MongoDB –∑–∞–ø—Ä–æ—Å

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î (—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–µ–µ)
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è
- –ú–µ–Ω—å—à–µ –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∏–∑ –ë–î

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–π MongoDB –∑–∞–ø—Ä–æ—Å
- –ù—É–∂–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –∏–∑ `isVisibleTo()`

**–ö–æ–¥:**
```javascript
// –î–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –æ–ø—Ä–æ—Å–æ–≤ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å
if (req.user?.role === 'student' && !showAll) {
  const g = currentUser?.group;
  const gid = currentUser?.group_id;
  const faculty = currentUser?.faculty;
  const program = currentUser?.program;
  const course = currentUser?.course;
  
  const visibilityOr = [
    // 1. –û–ø—Ä–æ—Å—ã –ë–ï–ó —Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥–∞ (–ø—É–±–ª–∏—á–Ω—ã–µ)
    {
      target_groups: { $size: 0 },
      target_faculties: { $size: 0 },
      target_programs: { $size: 0 },
      target_courses: { $size: 0 }
    },
    
    // 2. –û–ø—Ä–æ—Å—ã –¥–ª—è –≥—Ä—É–ø–ø—ã —Å—Ç—É–¥–µ–Ω—Ç–∞
    ...(gid ? [
      { target_groups: gid.toString() },
      { target_groups: gid },
      { target_groups: String(gid) }
    ] : []),
    ...(g ? [{ target_groups: g }] : []),
    
    // 3. –û–ø—Ä–æ—Å—ã –¥–ª—è —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞ —Å—Ç—É–¥–µ–Ω—Ç–∞
    ...(faculty ? [{ target_faculties: faculty }] : []),
    
    // 4. –û–ø—Ä–æ—Å—ã –¥–ª—è –ø—Ä–æ–≥—Ä–∞–º–º—ã —Å—Ç—É–¥–µ–Ω—Ç–∞
    ...(program ? [{ target_programs: program }] : []),
    
    // 5. –û–ø—Ä–æ—Å—ã –¥–ª—è –∫—É—Ä—Å–∞ —Å—Ç—É–¥–µ–Ω—Ç–∞
    ...(course ? [{ target_courses: course }] : [])
  ].filter(Boolean);
  
  roleScope.push({ $or: visibilityOr });
}
```

---

### ‚≠ê **–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ: –í–∞—Ä–∏–∞–Ω—Ç 1 + –í–∞—Ä–∏–∞–Ω—Ç 2**

**–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥:**

1. **–î–ª—è —Ñ–∏–ª—å—Ç—Ä–∞ `active`:** –ò—Å–ø—Ä–∞–≤–∏—Ç—å MongoDB –∑–∞–ø—Ä–æ—Å (–í–∞—Ä–∏–∞–Ω—Ç 2)
   - –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î
   - –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è

2. **–î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤:** –î–æ–±–∞–≤–∏—Ç—å post-filter —á–µ—Ä–µ–∑ `isVisibleTo()` (–í–∞—Ä–∏–∞–Ω—Ç 1)
   - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞
   - –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å

---

## üìù –¢–µ–∫—É—â–∞—è –ø—Ä–æ–±–ª–µ–º–∞ –≤ –¥–µ—Ç–∞–ª—è—Ö

### –ß—Ç–æ –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç:

```javascript
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (—Ç–µ–∫—É—â–∏–π –∫–æ–¥):
const visibilityOr = [
  { pollType: 'custom' },  // ‚Üê –í—Å–µ –∫–∞—Å—Ç–æ–º–Ω—ã–µ –æ–ø—Ä–æ—Å—ã
];
```

**–ü—Ä–∏–º–µ—Ä:**
```
–°—Ç—É–¥–µ–Ω—Ç: { group_id: '67890', group: '23–ü–ò01' }

–û–ø—Ä–æ—Å 1: { pollType: 'custom', target_groups: ['12345'] }  // –î–ª—è 22–ú–û05
  ‚Üí ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è (–ø–æ—Ç–æ–º—É —á—Ç–æ pollType === 'custom')  ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û!

–û–ø—Ä–æ—Å 2: { pollType: 'custom', target_groups: ['67890'] }  // –î–ª—è 23–ü–ò01
  ‚Üí ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
  
–û–ø—Ä–æ—Å 3: { pollType: 'lesson_review', target_groups: ['12345'] }
  ‚Üí ‚ùå –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
```

---

### –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:

```javascript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥):
const visibilityOr = [
  // –ü—É–±–ª–∏—á–Ω—ã–µ –æ–ø—Ä–æ—Å—ã (–±–µ–∑ —Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥–∞)
  {
    target_groups: { $size: 0 },
    target_faculties: { $size: 0 },
    target_programs: { $size: 0 },
    target_courses: { $size: 0 }
  },
  // –û–ø—Ä–æ—Å—ã –¥–ª—è –≥—Ä—É–ø–ø—ã —Å—Ç—É–¥–µ–Ω—Ç–∞
  { target_groups: currentUser.group_id.toString() },
  // –û–ø—Ä–æ—Å—ã –¥–ª—è —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞ —Å—Ç—É–¥–µ–Ω—Ç–∞
  { target_faculties: currentUser.faculty },
  // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
];
```

**–ü—Ä–∏–º–µ—Ä:**
```
–°—Ç—É–¥–µ–Ω—Ç: { group_id: '67890', group: '23–ü–ò01', faculty: '–§–ò–¢–∏–ê–ë–î' }

–û–ø—Ä–æ—Å 1: { pollType: 'custom', target_groups: ['12345'] }  // –î–ª—è 22–ú–û05
  ‚Üí ‚ùå –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è (–ø—Ä–∞–≤–∏–ª—å–Ω–æ!)  ‚úÖ

–û–ø—Ä–æ—Å 2: { pollType: 'custom', target_groups: ['67890'] }  // –î–ª—è 23–ü–ò01
  ‚Üí ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
  
–û–ø—Ä–æ—Å 3: { pollType: 'custom', target_groups: [] }  // –ü—É–±–ª–∏—á–Ω—ã–π
  ‚Üí ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
```

---

## üîç –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–æ–ª—è —Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥–∞

### 1. –í MongoDB –∑–∞–ø—Ä–æ—Å–µ (—á–∞—Å—Ç–∏—á–Ω–æ, —Å –±–∞–≥–æ–º):

**–§–∞–π–ª:** `pollController.js` (—Å—Ç—Ä–æ–∫–∏ 528-539)
```javascript
const groupConditions = [
  g ? { target_groups: g } : null,
  gid ? { target_groups: gid } : null,
  gid ? { target_groups: String(gid) } : null,
  g ? { 'lessonContext.group': g } : null,
  (g || gid) ? { 'lessonContext.groupId': (g || gid).toString() } : null
].filter(Boolean);
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –≠—Ç–∏ —É—Å–ª–æ–≤–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç, –ù–û –æ–Ω–∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω—ã —á–µ—Ä–µ–∑ `$or` —Å `{ pollType: 'custom' }`, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –∏—Ö –±–µ—Å–ø–æ–ª–µ–∑–Ω—ã–º–∏!

---

### 2. –í –º–µ—Ç–æ–¥–µ `isVisibleTo()`:

**–§–∞–π–ª:** `Poll.js` (—Å—Ç—Ä–æ–∫–∏ 416-433)
```javascript
// –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥—Ä—É–ø–ø—É
if (this.target_groups.length > 0 && user.group_id && 
    this.target_groups.includes(user.group_id.toString())) {
  return true;
}

// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–∞–∫—É–ª—å—Ç–µ—Ç
if (this.target_faculties.length > 0 && 
    this.target_faculties.includes(user.faculty)) {
  return true;
}

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–æ–≥—Ä–∞–º–º—É
if (this.target_programs.length > 0 && 
    this.target_programs.includes(user.program)) {
  return true;
}

// –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—É—Ä—Å
if (this.target_courses.length > 0 && 
    this.target_courses.includes(user.course)) {
  return true;
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –≠—Ç–æ—Ç –º–µ—Ç–æ–¥ –ù–ï –í–´–ó–´–í–ê–ï–¢–°–Ø –≤ `getPolls()`!

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –±–∞–≥–∞

### –®–∞–≥–∏ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:

1. **–°–æ–∑–¥–∞—Ç—å –æ–ø—Ä–æ—Å –∫–∞–∫ –∞–¥–º–∏–Ω:**
   ```javascript
   POST /api/admin/polls
   {
     title: "–û–ø—Ä–æ—Å –¥–ª—è 22–ú–û05",
     pollType: "custom",
     target_groups: ["12345"],  // ID –≥—Ä—É–ø–ø—ã 22–ú–û05
     options: [...]
   }
   ```

2. **–í–æ–π—Ç–∏ –∫–∞–∫ —Å—Ç—É–¥–µ–Ω—Ç –≥—Ä—É–ø–ø—ã 23–ü–ò01:**
   ```javascript
   {
     group_id: "67890",
     group: "23–ü–ò01",
     faculty: "–§–ò–¢–∏–ê–ë–î"
   }
   ```

3. **–ó–∞–ø—Ä–æ—Å–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –æ–ø—Ä–æ—Å—ã:**
   ```javascript
   GET /api/polls?filter=active
   ```

4. **–†–µ–∑—É–ª—å—Ç–∞—Ç (–±–∞–≥):**
   ```javascript
   {
     polls: [
       {
         title: "–û–ø—Ä–æ—Å –¥–ª—è 22–ú–û05",  // ‚ùå –í–ò–î–ò–¢, —Ö–æ—Ç—è –Ω–µ –¥–æ–ª–∂–µ–Ω!
         target_groups: ["12345"]
       }
     ]
   }
   ```

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –î–æ –∏ –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –î–û –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

```javascript
// MongoDB –∑–∞–ø—Ä–æ—Å –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞ –≥—Ä—É–ø–ø—ã 23–ü–ò01:
{
  status: 'active',
  end_date: { $gt: now },
  voted_users: { $ne: userId },
  $or: [
    { pollType: 'custom' },  // ‚ùå –ë–ê–ì: –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –í–°–ï –∫–∞—Å—Ç–æ–º–Ω—ã–µ –æ–ø—Ä–æ—Å—ã!
    { target_groups: '67890' }
  ]
}

// –†–µ–∑—É–ª—å—Ç–∞—Ç:
// ‚úÖ –û–ø—Ä–æ—Å—ã –¥–ª—è 23–ü–ò01
// ‚ùå –û–ø—Ä–æ—Å—ã –¥–ª—è 22–ú–û05 (–ø–æ—Ç–æ–º—É —á—Ç–æ pollType === 'custom')
// ‚ùå –û–ø—Ä–æ—Å—ã –¥–ª—è –ª—é–±–æ–π –¥—Ä—É–≥–æ–π –≥—Ä—É–ø–ø—ã (–ø–æ—Ç–æ–º—É —á—Ç–æ pollType === 'custom')
```

---

### –ü–û–°–õ–ï –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

```javascript
// MongoDB –∑–∞–ø—Ä–æ—Å –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞ –≥—Ä—É–ø–ø—ã 23–ü–ò01:
{
  status: 'active',
  end_date: { $gt: now },
  voted_users: { $ne: userId },
  $or: [
    // –ü—É–±–ª–∏—á–Ω—ã–µ –æ–ø—Ä–æ—Å—ã (–±–µ–∑ —Ç–∞—Ä–≥–µ—Ç–∏–Ω–≥–∞)
    {
      target_groups: { $size: 0 },
      target_faculties: { $size: 0 },
      target_programs: { $size: 0 },
      target_courses: { $size: 0 }
    },
    // –û–ø—Ä–æ—Å—ã –¥–ª—è –≥—Ä—É–ø–ø—ã 23–ü–ò01
    { target_groups: '67890' },
    // –û–ø—Ä–æ—Å—ã –¥–ª—è —Ñ–∞–∫—É–ª—å—Ç–µ—Ç–∞ –§–ò–¢–∏–ê–ë–î
    { target_faculties: '–§–ò–¢–∏–ê–ë–î' }
  ]
}

// –†–µ–∑—É–ª—å—Ç–∞—Ç:
// ‚úÖ –û–ø—Ä–æ—Å—ã –¥–ª—è 23–ü–ò01
// ‚úÖ –û–ø—Ä–æ—Å—ã –¥–ª—è –≤—Å–µ–≥–æ –§–ò–¢–∏–ê–ë–î
// ‚úÖ –ü—É–±–ª–∏—á–Ω—ã–µ –æ–ø—Ä–æ—Å—ã
// ‚ùå –û–ø—Ä–æ—Å—ã –¥–ª—è 22–ú–û05 (–ø—Ä–∞–≤–∏–ª—å–Ω–æ!)
```

---

## ‚ö†Ô∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –ù–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ñ–æ—Ä–º–∞—Ç–æ–≤ `group_id`

–í –º–µ—Ç–æ–¥–µ `isVisibleTo()`:
```javascript
this.target_groups.includes(user.group_id.toString())
```

–í MongoDB –∑–∞–ø—Ä–æ—Å–µ:
```javascript
{ target_groups: g }        // –ú–æ–∂–µ—Ç –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞ "22–ú–û05"
{ target_groups: gid }      // –ú–æ–∂–µ—Ç –±—ã—Ç—å —á–∏—Å–ª–æ 12345
{ target_groups: String(gid) }  // –°—Ç—Ä–æ–∫–∞ "12345"
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –±–∞–∑–µ –º–æ–≥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è:
- ID –≥—Ä—É–ø–ø—ã (—á–∏—Å–ª–æ): `12345`
- –ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã: `"22–ú–û05"`
- ID –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞: `"12345"`

**–†–µ—à–µ–Ω–∏–µ:** –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è `target_groups` (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è ID –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞).

---

### 2. –ü–æ–ª–µ `pollType` vs –¢–∞—Ä–≥–µ—Ç–∏–Ω–≥

**–¢–µ–∫—É—â–∞—è –ª–æ–≥–∏–∫–∞:** `pollType: 'custom'` ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤—Å–µ–º

**–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞:** –ü—Ä–æ–≤–µ—Ä—è—Ç—å `target_*` –ø–æ–ª—è, –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç `pollType`

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π —á–µ–∫-–ª–∏—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

- [ ] –£–¥–∞–ª–∏—Ç—å `{ pollType: 'custom' }` –∏–∑ `visibilityOr`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø—É–±–ª–∏—á–Ω—ã—Ö –æ–ø—Ä–æ—Å–æ–≤ (`target_*` –≤—Å–µ –ø—É—Å—Ç—ã–µ)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `target_faculties`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `target_programs`
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `target_courses`
- [ ] –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç `group_id` (—Å—Ç—Ä–æ–∫–∞ vs —á–∏—Å–ª–æ)
- [ ] –î–æ–±–∞–≤–∏—Ç—å post-filter —á–µ—Ä–µ–∑ `isVisibleTo()` –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∑–∞—â–∏—Ç—ã
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å –æ–ø—Ä–æ—Å–∞–º–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –≥—Ä—É–ø–ø

---

–ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –ø–æ–Ω—è—Ç–Ω–∞ –≤—Å—è —Ü–µ–ø–æ—á–∫–∞ –∏ –∏—Å—Ç–æ—á–Ω–∏–∫ –±–∞–≥–∞. üéØ
